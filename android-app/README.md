# MTXCast Android Client

MTXCastサーバーをAndroidデバイスから制御するためのアプリケーションです。

## 機能

- サーバーステータスの表示（リアルタイム更新）
- 再生制御（再生/一時停止/停止）
- 音量調整
- シーク機能
- URLからメディア再生（YouTube等）
- ファイルアップロードと再生
- サーバー設定（URL、APIトークン）

## ビルド方法

### 前提条件

- Android Studio Hedgehog (2023.1.1) 以降
- JDK 8 以降
- Android SDK 24 以降

### ビルド手順

1. Android Studioでプロジェクトを開く
2. `File > Sync Project with Gradle Files` を実行
3. `Build > Make Project` でビルド
4. デバイスまたはエミュレータで実行

### Gradleコマンドでビルド

```bash
cd android-app
./gradlew assembleDebug
```

APKファイルは `app/build/outputs/apk/debug/app-debug.apk` に生成されます。

## 使用方法

### 初回設定

1. アプリを起動
2. メニューから「Settings」を選択
3. サーバーURLを入力（例: `http://192.168.1.100:8080`）
4. APIトークンが設定されている場合は入力（オプション）
5. 「Save」をタップ

### 基本操作

- **ステータス**: 画面上部に現在のストリーム情報が表示されます（2秒ごとに自動更新）
- **再生制御**: Play/Pause/Stopボタンで制御
- **音量**: スライダーで音量調整（0-100%）
- **シーク**: 「Seek」ボタンで位置を指定してシーク
- **URL再生**: 「Play URL」ボタンでURLを入力して再生
- **ファイルアップロード**: 「Upload File」ボタンでファイルを選択してアップロード

### スクリーンミラーリング (MediaProjection + WHIP)

1. 設定画面でサーバーURLおよび必要に応じてAPIトークンを登録します。WHIPエンドポイントは `http(s)://<サーバー>/whip` 固定です。
2. メイン画面下部の「Screen Mirroring」カードで、エンドポイント表示が正しいことを確認します。
3. 「Start Mirroring」をタップし、Androidの画面キャプチャ許可ダイアログで「今すぐ開始」を選択します。
4. MediaProjectionで取得した画面映像がWebRTC経由でWHIPエンドポイントに送信され、サーバー側プレイヤーにミラーリングされます。
5. 停止したい場合は同じボタンが「Stop Mirroring」に変わるのでタップしてください。セッション終了時にはWHIPリソースが自動削除されます。

> **補足**: ミラーリングはアプリ実行中のみ動作します。バックグラウンド実行や通知表示は行わないため、長時間配信する場合は画面がスリープしないようにご注意ください。

## 注意事項

- サーバーとAndroidデバイスが同じネットワークに接続されている必要があります
- HTTP通信を使用するため、HTTPSが必要な場合はサーバー側で設定してください
- ファイルアップロードは大きなファイルの場合、時間がかかる場合があります

## トラブルシューティング

### 接続エラーが発生する場合

1. サーバーが起動しているか確認
2. サーバーURLが正しいか確認（`http://` または `https://` で始まる必要があります）
3. ファイアウォール設定を確認
4. 同じネットワークに接続されているか確認

### APIトークンエラーが発生する場合

1. サーバー側でAPIトークンが設定されているか確認
2. 設定画面でAPIトークンが正しく入力されているか確認

## ライセンス

本プロジェクトは同一ルートにある `LICENSE` に従います。
